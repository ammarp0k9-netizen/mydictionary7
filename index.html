<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù‚Ø§Ù…ÙˆØ³</title>
    <style>
        :root { 
            --primary: #3498db; 
            --star-color: #f1c40f; 
            --bg: #f4f7f6; 
            --card-bg: #ffffff;
            --text-main: #2c3e50;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--bg); 
            padding: 15px; 
            color: var(--text-main); 
        }

        .container { 
            max-width: 480px; 
            margin: auto; 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
        }

        h2 { 
            text-align: center; 
            color: #2c3e50; 
            font-size: 2.2rem; 
            margin-top: 0; 
            margin-bottom: 20px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-size: 13px;
            font-weight: bold;
            color: #7f8c8d;
            border: 1px solid #eee;
        }

        .input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
        input, select, textarea { 
            padding: 12px; border: 2px solid #eee; border-radius: 12px; outline: none; 
            text-align: center; font-size: 15px; font-family: inherit;
        }
        input:focus, textarea:focus { border-color: var(--primary); }
        
        .btn-main { 
            background: var(--primary); color: white; border: none; padding: 14px; 
            border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }

        .toolbar { display: flex; gap: 8px; margin-bottom: 15px; }
        .btn-tool { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-weight: 600; }
        .active-tool { background: var(--primary); color: white; border-color: var(--primary); }

        #searchInput { width: 100%; box-sizing: border-box; background: #fff9db; border: 2px solid #f1c40f; margin-bottom: 15px; }

        ul { list-style: none; padding: 0; }
        li { 
            background: #fff; margin-bottom: 10px; padding: 16px; border-radius: 15px; 
            border-right: 6px solid var(--primary); box-shadow: 0 3px 10px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column; gap: 8px; cursor: pointer; transition: 0.3s;
            position: relative;
        }
        li:hover { transform: scale(1.02); background: #fdfdfd; }

        .reorder-mode-li { 
            border: 1px dashed #ccc !important; 
            border-right: 6px solid var(--primary) !important;
            cursor: move;
        }
        
        .selected-for-move {
            background-color: #e3f2fd !important;
            border-color: var(--primary) !important;
        }

        .top-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        
        .star-btn { 
            font-size: 24px; cursor: pointer; color: #ddd; background: none; border: none; padding: 0; transition: 0.2s;
        }
        .star-btn.active { color: var(--star-color); }

        .word-box { flex-grow: 1; text-align: right; }
        .word-text { font-weight: bold; font-size: 1.2em; color: #2c3e50; }
        .meaning-text { color: #7f8c8d; font-size: 1em; }

        .actions { display: flex; gap: 8px; }
        .icon-circle {
            width: 38px; height: 38px; border-radius: 50%; border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; font-size: 18px;
        }
        .sound-btn { background: #ebf5fb; color: #3498db; }
        .edit-btn { background: #eafaf1; color: #27ae60; }
        .del-btn { background: #fdedec; color: #e74c3c; }

        .cat-tag { 
            font-size: 11px; padding: 3px 10px; border-radius: 8px; 
            font-weight: bold; margin-right: 8px; color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .tag-ÙØ¹Ù„ { background: #e67e22; opacity: 0.85; }
        .tag-Ø§Ø³Ù… { background: #8e44ad; opacity: 0.85; }
        .tag-ØµÙØ© { background: #27ae60; opacity: 0.85; }
        .tag-Ø£Ø¯Ø§Ø© { background: #c0392b; opacity: 0.85; }
        .tag-Ø¬Ù…Ù„ { background: #16a085; opacity: 0.85; }
        .tag-Ø¹Ø§Ù… { background: #7f8c8d; opacity: 0.85; }
        .tag-Ø¸Ø±Ù { background: #007bff; opacity: 0.85; }

        .example-box { 
            font-size: 0.95em; color: #95a5a6; font-style: italic; border-top: 1px solid #f0f0f0; 
            margin-top: 8px; padding-top: 8px; display: none; text-align: left; direction: ltr; 
        }
        .show-example .example-box { display: block; }

        .backup-zone { margin-top: 25px; border-top: 2px dashed #eee; padding-top: 15px; display: flex; gap: 10px; }
        .btn-backup { flex: 1; padding: 10px; font-size: 12px; background: #95a5a6; color: white; border-radius: 10px; border: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="mainTitle">Ø§Ù„Ù‚Ø§Ù…ÙˆØ³</h2>

    <div class="stats-bar">
        <span id="totalCount">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: 0</span>
        <span id="starredCount">â­ Ø§Ù„ØµØ¹Ø¨Ø©: 0</span>
    </div>
    
    <div class="input-group">
        <input type="text" id="wordInput" placeholder="Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ">
        <input type="text" id="meaningInput" placeholder="Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ">
        <textarea id="exampleInput" placeholder="Ø¬Ù…Ù„Ø© Ù…Ø«Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" rows="2"></textarea>
        <select id="categoryInput">
            <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
            <option value="ÙØ¹Ù„">ÙØ¹Ù„</option>
            <option value="Ø§Ø³Ù…">Ø§Ø³Ù…</option>
            <option value="ØµÙØ©">ØµÙØ©</option>
            <option value="Ø£Ø¯Ø§Ø©">Ø£Ø¯Ø§Ø©</option>
            <option value="Ø¸Ø±Ù">Ø¸Ø±ÙˆÙ</option>
            <option value="Ø¬Ù…Ù„">Ø¬Ù…Ù„ Ø´Ø§Ø¦Ø¹Ø©</option>
            <option value="Ø¸Ø±Ù">Ø¸Ø±ÙˆÙ</option>
        </select>
        <button class="btn-main" id="addBtn" onclick="addWord()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ù…ÙˆØ³</button>
    </div>

    <div class="toolbar">
        <button id="toolAll" class="btn-tool active-tool" onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
       <button id="toolStarred" class="btn-tool" onclick="setFilter('starred')" title="Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØµØ¹Ø¨Ø©">â­</button>
        <button id="reorderBtn" class="btn-tool" onclick="toggleReorderMode()" title="ØªØ±ØªÙŠØ¨ ÙŠØ¯ÙˆÙŠ">ğŸ”„</button>
    </div>

    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒÙ„Ù…Ø©ØŒ Ù…Ø¹Ù†Ù‰ Ø£Ùˆ Ø¬Ù…Ù„Ø©..." onkeyup="render()">

    <ul id="list"></ul>

    <div class="backup-zone">
        <button class="btn-backup" onclick="exportData()">ğŸ“¥ ØªØµØ¯ÙŠØ±</button>
        <button class="btn-backup" onclick="document.getElementById('importFile').click()">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
    </div>
</div>

<script>
    let words = JSON.parse(localStorage.getItem('myContextDict')) || [];
    let currentFilter = 'all';
    let editId = null;
    let isReorderMode = false;
    let selectedIndices = [];

    function addWord() {
        let w = document.getElementById('wordInput').value.trim();
        let m = document.getElementById('meaningInput').value.trim();
        let ex = document.getElementById('exampleInput').value.trim();
        let c = document.getElementById('categoryInput').value;
        if(!w || !m) return;

        if (editId) {
            words = words.map(item => item.id === editId ? {...item, word: w, meaning: m, example: ex, category: c} : item);
            editId = null;
            document.getElementById('addBtn').innerText = "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ù…ÙˆØ³";
            document.getElementById('addBtn').style.background = "#3498db";
        } else {
            words.unshift({ id: Date.now() + Math.random(), word: w, meaning: m, example: ex, category: c, starred: false });
        }
        
        clearInputs();
        saveAndRender();
    }

    function clearInputs() {
        document.getElementById('wordInput').value = '';
        document.getElementById('meaningInput').value = '';
        document.getElementById('exampleInput').value = '';
        document.getElementById('categoryInput').value = 'Ø¹Ø§Ù…';
    }

    function toggleStar(id, event) {
        event.stopPropagation();
        words = words.map(w => w.id === id ? {...w, starred: !w.starred} : w);
        saveAndRender();
    }

    function setFilter(f) {
        currentFilter = f;
        document.getElementById('toolAll').classList.toggle('active-tool', f === 'all');
        document.getElementById('toolStarred').classList.toggle('active-tool', f === 'starred');
        render();
    }

    function startEdit(id, event) {
        event.stopPropagation();
        let item = words.find(w => w.id === id);
        if(!item) return;
        document.getElementById('wordInput').value = item.word;
        document.getElementById('meaningInput').value = item.meaning;
        document.getElementById('exampleInput').value = item.example || '';
        document.getElementById('categoryInput').value = item.category;
        editId = id;
        document.getElementById('addBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„Ù…Ø©";
        document.getElementById('addBtn').style.background = "#27ae60";
        window.scrollTo(0,0);
    }

    function deleteWord(id, event) {
        event.stopPropagation();
        if(confirm("Ø­Ø°ÙØŸ")) {
            words = words.filter(w => w.id !== id);
            saveAndRender();
        }
    }

  function playSound(word, event) {
    if (event) event.stopPropagation();
    const cleanWord = word.trim().toLowerCase();

    // 1. Ø¬Ø±Ø¨ ØªØ´ØºÙ„ ÙˆÙŠØ¨Ø³ØªØ± (Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙˆØ¹)
    const audio = new Audio(`sounds/${cleanWord}.mp3`);
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
    const playPromise = audio.play();

    if (playPromise !== undefined) {
        playPromise.then(() => {
            // Ø§Ø´ØªØºÙ„ ÙˆÙŠØ¨Ø³ØªØ± Ø¨Ù†Ø¬Ø§Ø­
            console.log("Webster played");
        }).catch(() => {
            // 2. Ø¥Ø°Ø§ ÙØ´Ù„ ÙˆÙŠØ¨Ø³ØªØ± (Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ø´ Ø¹Ù†Ø¯Ùƒ)ØŒ Ø´ØºÙ„ Ù…Ø­Ø±Ùƒ Ø§Ù„ØªÙ„ÙÙˆÙ† ÙÙˆØ±Ø§Ù‹
            console.log("Using Device TTS...");
            
            // Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ ØµÙˆØª Ù…Ø¹Ù„Ù‚ (Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯)
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;

            // Ø³Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: Ù„Ø§Ø²Ù… Ù†Ø·Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆØ§Øª ÙˆÙ†Ø­Ø±Ùƒ Ø§Ù„Ù…Ø­Ø±Ùƒ
            const voices = window.speechSynthesis.getVoices();
            if (voices.length > 0) {
                // Ø¨Ù†Ø­Ø§ÙˆÙ„ Ù†Ù„Ø§Ù‚ÙŠ ØµÙˆØª Google English
                const englishVoice = voices.find(v => v.lang.includes('en') && v.name.includes('Google')) || voices[0];
                utterance.voice = englishVoice;
            }

            window.speechSynthesis.speak(utterance);
        });
    }
}

// Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„Ù„ÙŠ "Ø¨ÙŠØµØ­ÙŠ" Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„ØªÙ„ÙÙˆÙ† Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
window.onload = function() {
    if ('speechSynthesis' in window) {
        // Ù†Ø¯Ø§Ø¡ ÙˆÙ‡Ù…ÙŠ Ø¨Ø³ Ø¹Ø´Ø§Ù† ÙŠØ¬Ù‡Ø² Ø§Ù„Ù…Ø­Ø±Ùƒ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        window.speechSynthesis.getVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
        }
    }
    // Ø´ØºÙ„ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ ØªØ¨Ø¹ØªÙƒ Ù‡ÙˆÙ† ÙƒÙ…Ø§Ù†
    if (typeof displayWords === "function") displayWords();
};

    function handleLiClick(index, el) {
        if (isReorderMode) {
            if (selectedIndices.includes(index)) {
                selectedIndices = selectedIndices.filter(i => i !== index);
                el.classList.remove('selected-for-move');
            } else {
                selectedIndices.push(index);
                el.classList.add('selected-for-move');
            }
        } else {
            el.classList.toggle('show-example');
        }
    }

    function toggleReorderMode() {
        isReorderMode = !isReorderMode;
        selectedIndices = [];
        const btn = document.getElementById('reorderBtn');
        btn.classList.toggle('active-tool', isReorderMode);
        btn.innerText = isReorderMode ? "âœ…Ø­ÙØ¸ Ø§Ù„ØªØ±ØªÙŠØ¨ " : "ğŸ”„";
        if (!isReorderMode) {
            localStorage.setItem('myContextDict', JSON.stringify(words));
        }
        render();
    }

    function allowDrop(ev) { ev.preventDefault(); }
    
    function drag(ev, index) { 
        if (!selectedIndices.includes(index)) {
            selectedIndices = [index];
        }
        ev.dataTransfer.setData("draggedIndices", JSON.stringify(selectedIndices));
    }

    function drop(ev, dropIndex) {
        ev.preventDefault();
        let draggedIndices = JSON.parse(ev.dataTransfer.getData("draggedIndices")).sort((a,b) => b-a);
        
        let itemsToMove = [];
        draggedIndices.forEach(idx => {
            itemsToMove.push(words.splice(idx, 1)[0]);
        });
        itemsToMove.reverse();

        let actualDropIndex = dropIndex;
        draggedIndices.forEach(idx => { if (idx < dropIndex) actualDropIndex--; });
        if (actualDropIndex < 0) actualDropIndex = 0;

        words.splice(actualDropIndex, 0, ...itemsToMove);
        
        selectedIndices = []; 
        render();
    }

    function saveAndRender() {
        localStorage.setItem('myContextDict', JSON.stringify(words));
        render();
    }

    function render() {
        updateStats();
        let query = document.getElementById('searchInput').value.toLowerCase();
        let html = '';
        let filtered = words.filter(w => (w.word.toLowerCase().includes(query) || w.meaning.includes(query) || (w.example && w.example.toLowerCase().includes(query))) && (currentFilter === 'all' || w.starred));

        filtered.forEach((w, index) => {
            const dragAttrs = isReorderMode ? `draggable="true" ondragstart="drag(event, ${index})" ondragover="allowDrop(event)" ondrop="drop(event, ${index})"` : '';
            const reorderClass = isReorderMode ? 'reorder-mode-li' : '';
            const selectedClass = selectedIndices.includes(index) ? 'selected-for-move' : '';

            html += `
                <li ${dragAttrs} class="${reorderClass} ${selectedClass}" onclick="handleLiClick(${index}, this)">
                    <div class="top-row">
                        <button class="star-btn ${w.starred ? 'active' : ''}" onclick="toggleStar(${w.id}, event)" title="Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµØ¹Ø¨Ø©">â˜…</button>
                        <div class="word-box">
                            <div class="word-text">${w.word} <span class="cat-tag tag-${w.category}">${w.category}</span></div>
                            <div class="meaning-text">${w.meaning}</div>
                        </div>
                        ${isReorderMode ? '<span style="font-size:20px; color:#ccc;">â˜°</span>' : `
                        <div class="actions">
                            <button class="icon-circle sound-btn" onclick="playSound('${w.word}', event)">ğŸ”Š</button>
                            <button class="icon-circle edit-btn" onclick="startEdit(${w.id}, event)">ğŸ“</button>
                            <button class="icon-circle del-btn" onclick="deleteWord(${w.id}, event)">Ã—</button>
                        </div>`}
                    </div>
                    ${w.example ? `<div class="example-box"><b>Ex:</b> ${w.example}</div>` : ''}
                </li>`;
        });
        document.getElementById('list').innerHTML = html;
    }

    function updateStats() {
        document.getElementById('totalCount').innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ${words.length}`;
        document.getElementById('starredCount').innerText = `â­ Ø§Ù„ØµØ¹Ø¨Ø©: ${words.filter(w => w.starred).length}`;
    }

    function exportData() {
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(JSON.stringify(words));
        const link = document.createElement('a');
        link.setAttribute('href', dataUri);
        link.setAttribute('download', 'my_dict.json');
        link.click();
    }

    function importData(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            words = JSON.parse(e.target.result).map(i => ({...i, id: i.id || Math.random()}));
            saveAndRender();
        };
        reader.readAsText(event.target.files[0]);
    }

    render();
</script>
</body>
</html>







